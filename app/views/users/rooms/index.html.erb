<div class="container">
  <div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12">
      <div class="d-flex justify-content-end search-btn">
        <%= form_tag({controller:"rooms", action:"index"}, method: :get) do %>
          <%= text_field_tag :search %>
          <%= submit_tag 'キーワード検索', class: "btn btn-light" %>
        <% end %>
      </div>
      <div class="d-flex justify-content-end search-btn">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="キーワード">
            <div class="input-group-append">
              <button class="btn btn-secondary" type="button">
                <i class="fa fa-search"></i>
              </button>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container pt-3">
  <div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12">
      <div class="d-flex justify-content-end search-btn">
        <%= form_with url: rooms_path, method: :get do |f| %>
        <%= f.collection_check_boxes(:category_ids, Category.all, :id, :name) do |category| %>
          <span style="padding-left: 10px;">
            <% if category.text.in?(@category_name) %>
              <%= category.check_box(checked: true) %> 
            <% else %>
              <%= category.check_box(checked: false) %> 
            <% end %>
          <%= category.text %>
          </span>
        <% end %>
        <span style="padding-left: 10px;">
          <%= submit_tag 'カテゴリ検索', class: "btn btn-light" %>
        </span>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container pt-4">
  <div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12 p-0">
      <h5>トークルーム一覧</h5>
    </div>
  </div>
  <div class="row pt-3">
    <div class="col-sm-12 col-md-12 col-lg-12">
      <table class="table">
        <tbody>
          <% @rooms.each do |room| %>
          <tr>
            <td class="col-sm-1 col-md-1 col-lg-1">
              <%= image_tag room.user.get_profile_image %>
            </td>
            <td class="col-sm-3 col-md-3 col-lg-3">
              <%= link_to user_path(room.user.id) do %>
                <span style="text-decoration: underline;"><%= room.user.name %></span>
              <% end %>さん
            </td>
            <td class="col-sm-3 col-md-3 col-lg-3">
              <%= Category.where(id: room.category_rooms.pluck(:category_id)).pluck(:name).join(" / ") %>
            </td>
            <td class="col-sm-3 col-md-3 col-lg-3">
              <%= link_to room_path(room.id) do %>
                <span style="text-decoration: underline;"><%= room.title %></span>
              <% end %>
            </td>
            <td class="col-sm-2 col-md-2 col-lg-2">
              <%= localize room.updated_at, format: :short %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="d-flex justify-content-center p-2">
    <%= paginate @rooms %>
  </div>
</div>
<div class="container pt-4 pb-5">
  <div class="row pt-3">
    <div class="col-sm-12 col-md-12 col-lg-12 p-0">
      <h5>新規トークルーム設立</h5>
    </div>
  </div>
  <div class="row pl-5">
    <!--バリデーション設定-->
    <% if @room.errors.any? %>
      <div class = "alert">
      <%= @room.errors.count %>件のエラーが発生しました。
        <ul>
          <% @room.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>
  <div class="row pl-5">
    <% if flash[:alert] %>
      <%= flash[:alert] %>
    <% end %>
  </div>
  <%= form_with model: @room, url: rooms_path, method: :post do |f| %>
  <div class="row pt-3 pl-5">
    <div class="col-sm-2 col-md-2 col-lg-2">
      <%= f.label :title %>
    </div>
    <div class="col-sm-10 col-md-10 col-lg-10">
      <%= f.text_field :title, placeholder: "トークルーム名", class: 'form-control', size: "2" %>
    </div>
  </div>
  <div class="row pt-3 pl-5">
    <div class="col-sm-2 col-md-2 col-lg-2">
      <%= f.label :category_name %>
    </div>
    <div class="col-sm-10 col-md-10 col-lg-10">
      <%= f.collection_check_boxes(:category_ids, Category.all, :id, :name) do |category| %>
        <%= category.label do %>
          <span class="pr-4">
            <%= category.check_box %>
            <%= category.text %>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="row pt-3 pl-5">
    <div class="col-sm-2 col-md-2 col-lg-2">
      <%= f.label :body %>
    </div>
    <div class="col-sm-10 col-md-10 col-lg-10">
      <%= f.text_area :body, placeholder: "本文" , class: 'form-control',size: "2x3" %>
    </div>
  </div>
  <div class="row pt-3 pl-5">
    <div class="col-sm-2 col-md-2 col-lg-2"></div>
    <div class="col-sm-10 col-md-10 col-lg-10">
      <%= f.radio_button :status, Room.statuses.key(0) %>
      <%= f.label :status, Room.statuses_i18n[:open] %>
      <span style="padding-left: 30px;">
        <%= f.radio_button :status, Room.statuses.key(2) %>
        <%= f.label :status, Room.statuses_i18n[:close] %></span>
    </div>
  </div>
  <div class="row pt-3 pl-5">
    <div class="col-sm-2 col-md-2 col-lg-2"></div>
    <div class="col-sm-10 col-md-10 col-lg-10 new-create-btn">
      <%= f.submit "トークルーム設立！", class: "btn btn-success btn-sm rounded-pill" %>
    </div>
  </div>
  <% end %>
</div>